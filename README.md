# FoodTracker — архитектура и техническое описание

Телеграм-бот для трекинга воды, калорий и активности. Ниже приведён разбор архитектуры и назначения основных модулей.

## Архитектура и структура проекта

```
├── main.py                # Точка входа, запуск aiogram-бота, регистрация роутеров и middlewares
├── requirements.txt       # Зависимости проекта
├── Dockerfile             # Описание контейнера для запуска в Docker
├── foodtrack, foodtrack.pub  # (служебные/вспомогательные файлы, если есть)
├── database/
│   ├── engine.py          # Инициализация асинхронного движка SQLAlchemy и сессий
│   ├── models.py          # Описание ORM-моделей: User, WaterLog, FoodLog, WorkoutLog, DailyStats
│   └── utils.py           # Утилиты для работы с БД: создание/обновление пользователя, расчёт норм, работа с погодой
├── middlewares/
│   └── db.py              # Middleware для проброса асинхронной сессии БД в хэндлеры aiogram
├── routers/
│   ├── profile.py         # FSM-логика для пошагового заполнения профиля пользователя
│   └── progress.py        # Логика логирования воды, еды, тренировок, расчёт прогресса
```

### main.py
Точка входа. Запускает aiogram-бота, подключает роутеры (`profile`, `progress`), инициализирует БД, настраивает middleware для работы с сессией SQLAlchemy.

### database/
- **engine.py** — создание асинхронного движка и фабрики сессий SQLAlchemy, функция инициализации БД.
- **models.py** — ORM-модели пользователей, логов воды/еды/тренировок и ежедневной статистики. Связи между таблицами через SQLAlchemy ORM.
- **utils.py** — функции для создания/обновления пользователя, получения/создания дневной статистики, расчёта норм воды/калорий, получения температуры через OpenWeatherMap API.

### middlewares/
- **db.py** — кастомный middleware для aiogram, который добавляет асинхронную сессию БД в контекст каждого запроса.

### routers/
- **profile.py** — FSM (Finite State Machine) сценарий для пошагового заполнения профиля пользователя (вес, рост, возраст, активность, город). После заполнения — расчёт норм и сохранение в БД.
- **progress.py** — обработчики команд для логирования воды, еды (с интеграцией с OpenFoodFacts API), тренировок, а также для вывода прогресса пользователя за день. Использует асинхронные запросы к БД и расчёт статистики.

### requirements.txt
Список всех зависимостей проекта (aiogram, SQLAlchemy, aiohttp, python-dotenv и др.).

### Dockerfile
Позволяет собрать и запустить проект в контейнере. Устанавливает зависимости и запускает main.py.

## Переменные окружения

- `TOKEN` — токен Telegram-бота
- `OPENWEATHER_API_KEY` — API-ключ OpenWeatherMap для получения погоды

## Примечания
- Все взаимодействие с БД — асинхронное (SQLAlchemy async).
- Для хранения данных используется SQLite (можно заменить на другую СУБД при необходимости).
- Для интеграции с внешними API используется aiohttp.
- FSM aiogram применяется для пошагового диалога при заполнении профиля.